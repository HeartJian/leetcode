<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>

<body>
    <div id="app">
        <input v-modal="inputValue" />
        <span id="text" v-text="inputValue"></span>

        </div>
</body>

<script>
    class Vue {
        constructor(options){
            this.options =options;
            this._directives= {};
            this.$el = document.querySelector(options.el);
            this.$data = options.data
            this._observe(this.$data);
            this._compile(this.$el)
        }

        _compile(el){
            let nodes =el.children;
            for(let node of nodes){
                if(node.children.length>0){
                    this._compile(node)
                };
                if(node.hasAttribute("v-text")){
                    this._directives[node.getAttribute("v-text")].push(
                        new Watcher(node,"innerHTML",node.getAttribute("v-text"),this)
                    )
                };
                if(node.hasAttribute("v-modal")&& node.tagName =="INPUT" ){
                    this._directives[node.getAttribute("v-modal")].push(
                        new Watcher(node,"value",node.getAttribute("v-modal"),this)
                    );
                    node.addEventListener('input',(e)=>{
                      this.$data[node.getAttribute("v-modal")] = e.target.value
                    })
                };
            }

        }

        _observe(){
            for(let key in this.$data){
                    if(Object.prototype.toString.call(this.$data[key]) == "[object Object]"){
                        this._observe(this.$data[key])
                    }else{
                        let val =this.$data[key];
                        this._directives[key] = [];
                        let dir = this._directives[key];
                        Object.defineProperty(this.$data,key,{
                            set(value){
                                val =value;
                                dir.forEach(item=>item.update());
                            },
                            get(){
                                return val
                            }
                        })
                    }
                }
        }

    }

    class Watcher {
        constructor(node,attritude,key,vm){
            this.node = node;
            this.attritude = attritude;
            this.key =key;
            this.vm =vm;
            this.update();
        }
        update (){
            this.node[this.attritude] = this.vm.$data[this.key]
        }
    }

    window.vue = new Vue({
        el:'#app',
        data:{
            hello:1,
            inputValue:2
        }
    })
</script>
</html>